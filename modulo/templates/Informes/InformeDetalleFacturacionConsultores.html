{% extends 'Base.html' %}
{% load static %}
{% block titulo %} Informe Detalle Facturación Consultores {% endblock %}

{% block contenido %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h4 class="card-title">Informe Detalle - Facturación de Consultores</h4>
    </div>
    <div class="card-body informes-table">
        <div class="container-fluid mb-3">
            <form method="GET">
                <div class="row mb-3">
                    <div class="col-md-2">
                        <label for="Anio" class="form-label">{{ form.Anio.label }}</label>
                        {{ form.Anio }}
                    </div>
                    <div class="col-md-3">
                        <label for="Mes" class="form-label">{{ form.Mes.label }}</label>
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle w-100" type="button" id="dropdownMes" data-bs-toggle="dropdown" aria-expanded="false" data-selected-text="Seleccione Meses"></button>
                            <ul class="dropdown-menu w-100" aria-labelledby="dropdownMes">
                                {% for checkbox in form.Mes %}
                                    <li class="dropdown-item">
                                        <label class="form-check-label w-100">{{ checkbox.tag }} {{ checkbox.choice_label }}</label>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label for="Consultor" class="form-label">{{ form.Consultor.label }}</label>
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle w-100" type="button" id="dropdownConsultor" data-bs-toggle="dropdown" aria-expanded="false" data-selected-text="Seleccione Consultores"></button>
                            <ul class="dropdown-menu w-100" aria-labelledby="dropdownConsultor">
                                {% for checkbox in form.Consultor %}
                                    <li class="dropdown-item">
                                        <label class="form-check-label w-100">{{ checkbox.tag }} {{ checkbox.choice_label }}</label>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label for="LineaId" class="form-label">{{ form.LineaId.label }}</label>
                        <div class="dropdown">
                            <button class="btn btn-outline-primary dropdown-toggle w-100" type="button" id="dropdownLinea" data-bs-toggle="dropdown" aria-expanded="false" data-selected-text="Seleccione Línea"></button>
                            <ul class="dropdown-menu w-100" aria-labelledby="dropdownLinea">
                                {% for checkbox in form.LineaId %}
                                    <li class="dropdown-item">
                                        <label class="form-check-label w-100">{{ checkbox.tag }} {{ checkbox.choice_label }}</label>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 text-start">
                        <button type="submit" name="buscar" class="btn btn-primary">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                    </div>
                    <div class="col-md-6 text-end">
                        <button type="submit" formaction="{% url 'exportar_detalle_facturacion_consultores_excel' %}" class="btn btn-success">
                            <i class="fas fa-file-excel"></i> Descargar Excel
                        </button>
                    </div>
                </div>
            </form>
        </div>

        {% if show_data %}
        <div class="table-responsive" style="max-height: 80vh; overflow: auto;">
            <table class="table table-bordered table-hover table-primary w-100" id="detalleFacturacionConsultoresTable">
                <thead>
                    <tr>
                        <th data-sort="anio" class="sortable" data-direction="default">Año <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="mes" class="sortable" data-direction="default">Mes <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="consultor" class="sortable" data-direction="default">Consultor <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="empresa" class="sortable" data-direction="default">Empresa <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="linea" class="sortable" data-direction="default">Línea <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="cta" class="sortable" data-direction="default">N° Factura <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="periodo" class="sortable" data-direction="default">Periodo Cobrado <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="aprobado" class="sortable" data-direction="default">Aprobado Por <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="fecha_cobro" class="sortable" data-direction="default">Fecha de Cobro <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="fecha_pago" class="sortable" data-direction="default">Fecha de Pago <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="cliente" class="sortable" data-direction="default">Cliente <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="modulo" class="sortable" data-direction="default">Módulo <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="horas" class="sortable" data-direction="default">Horas <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="valor_unitario" class="sortable" data-direction="default">Valor Unitario <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="valor_cobro" class="sortable" data-direction="default">Valor Cobro <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="iva" class="sortable" data-direction="default">IVA <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="valor_neto" class="sortable" data-direction="default">Valor Neto <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="retencion" class="sortable" data-direction="default">Retención Fuente <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="valor_pagado" class="sortable" data-direction="default">Valor Pagado <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="factura" class="sortable" data-direction="default">Factura <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="valor_factura" class="sortable" data-direction="default">Valor Factura Cliente <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="fecha" class="sortable" data-direction="default">Fecha <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="deuda_tecnica" class="sortable" data-direction="default">Deuda Técnica <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="factura_pendiente" class="sortable" data-direction="default">Factura Pendiente <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="porcentaje_dif" class="sortable" data-direction="default">% Dif <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="diferencia_bruta" class="sortable" data-direction="default">Diferencia Bruta <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                        <th data-sort="observaciones" class="sortable" data-direction="default">Observaciones <span class="sort-icon"><i class="fas fa-sort sort-icon-default"></i><i class="fas fa-sort-up sort-icon-asc"></i><i class="fas fa-sort-down sort-icon-desc"></i></span></th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in resultados %}
                    <tr>
                        <td data-field="anio" class="text-end">{{ row.Anio }}</td>
                        <td data-field="mes" class="text-end">{{ row.Mes }}</td>
                        <td data-field="consultor" class="text-start">{{ row.Documento__Nombre|default:row.Documento__Documento }}</td>
                        <td data-field="empresa" class="text-start">{{ row.Empresa }}</td>
                        <td data-field="linea" class="text-start">{{ row.LineaId__Linea }}</td>
                        <td data-field="cta" class="text-start">{{ row.Cta_Cobro }}</td>
                        <td data-field="periodo" class="text-start">{{ row.Periodo_Cobrado }}</td>
                        <td data-field="aprobado" class="text-start">{{ row.Aprobado_Por }}</td>
                        <td data-field="fecha_cobro" class="text-end">{{ row.Fecha_Cobro|date:'Y-m-d' }}</td>
                        <td data-field="fecha_pago" class="text-end">{{ row.Fecha_Pago|date:'Y-m-d' }}</td>
                        <td data-field="cliente" class="text-start">{{ row.ClienteId__Nombre_Cliente }}</td>
                        <td data-field="modulo" class="text-start">{{ row.ModuloId__Modulo }}</td>
                        <td data-field="horas" class="text-end">{{ row.Horas }}</td>
                        <td data-field="valor_unitario" class="text-end">{{ row.Valor_Unitario }}</td>
                        <td data-field="valor_cobro" class="text-end">{{ row.Valor_Cobro }}</td>
                        <td data-field="iva" class="text-end">{{ row.IVA }}</td>
                        <td data-field="valor_neto" class="text-end">{{ row.Valor_Neto }}</td>
                        <td data-field="retencion" class="text-end">{{ row.Retencion_Fuente }}</td>
                        <td data-field="valor_pagado" class="text-end">{{ row.Valor_Pagado }}</td>
                        <td data-field="factura" class="text-start">{{ row.Factura }}</td>
                        <td data-field="valor_factura" class="text-end">{{ row.Valor_Fcta_Cliente }}</td>
                        <td data-field="fecha" class="text-end">{{ row.Fecha|date:'Y-m-d' }}</td>
                        <td data-field="deuda_tecnica" class="text-start">{{ row.Deuda_Tecnica }}</td>
                        <td data-field="factura_pendiente" class="text-start">{{ row.Factura_Pendiente }}</td>
                        <td data-field="porcentaje_dif" class="text-end">{{ row.Dif }}</td>
                        <td data-field="diferencia_bruta" class="text-end">{{ row.Diferencia_Bruta }}</td>
                        <td data-field="observaciones" class="text-start">{{ row.Observaciones }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <div class="alert alert-warning" role="alert">
                {% if not busqueda_realizada %}
                    No se ha realizado ninguna búsqueda aún.
                {% else %}
                    No se encontraron resultados para los filtros aplicados.
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

{% if mensaje %}
<div class="alert alert-info text-center mt-3">{{ mensaje }}</div>
{% endif %}
<script src="{% static 'JS/InformeDetalleFacturacionConsultores.js' %}"></script>
{% endblock %}


