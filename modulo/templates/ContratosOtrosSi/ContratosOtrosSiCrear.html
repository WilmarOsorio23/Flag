{% extends "Base.html" %}

{% block titulo %} Crear Contrato_Otro_Si {% endblock %}

{% block contenido %}
    <h2>Crear Nuevo Contrato Otro Si</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">Guardar</button>
        <a href="{% url 'contratos_otros_si_index' %}" class="btn btn-danger">Cancelar</a>
    </form>
{% endblock %}
{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    console.log("‚úÖ Script cargado correctamente");

    const clienteSelect = document.getElementById('id_ClienteId');
    const contratoSelect = document.getElementById('id_Contrato');

    if (!clienteSelect || !contratoSelect) {
        console.error("No se encontraron los campos Cliente o Contrato.");
        return;
    }

    clienteSelect.addEventListener('change', function () {
        const clienteId = this.value;
        console.log("‚û°Ô∏è Cliente seleccionado:", clienteId);

        contratoSelect.innerHTML = '<option value="">Cargando contratos...</option>';

        if (clienteId) {
            fetch(`/contratos_otros_si/obtener-contratos/${clienteId}/`)
                .then(response => response.json())
                .then(data => {
                    console.log("üì¶ Contratos recibidos:", data);
                    contratoSelect.innerHTML = '<option value="">Seleccione un contrato</option>';
                    data.contratos.forEach(c => {
                        const option = document.createElement('option');
                        option.value = c.id;
                        option.textContent = c.nombre;
                        contratoSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('‚ùå Error cargando contratos:', error);
                    contratoSelect.innerHTML = '<option value="">Error cargando contratos</option>';
                });
        } else {
            contratoSelect.innerHTML = '<option value="">Seleccione un cliente primero</option>';
        }
    });
});
</script>
{% endblock %}
