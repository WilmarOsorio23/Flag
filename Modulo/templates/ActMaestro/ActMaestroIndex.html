{% extends "Base.html" %}
{% load static %}
{% block titulo %} Actividades Pagaré {% endblock %}

{% block contenido %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h4 class="card-title">Gestión de Actividades Pagaré</h4>
    </div>
    <div class="card-body">
        <div class="button-group">
            <a class="btn btn-outline-primary fas fa-plus-circle" 
               href="{% url 'actividad_pagare_crear' %}" 
               title="Nueva Actividad"></a>
            <button id="edit-button" 
                    type="button"
                    class="btn btn-outline-primary fas fa-edit" 
                    onclick="enableEdit()" 
                    title="Editar">
            </button>
            <button id="save-button" 
                    class="btn btn-outline-success fas fa-save d-none" 
                    title="Guardar" 
                    onclick="saveRow()">
            </button>
            <button id="cancel-button" 
                    class="btn btn-outline-danger fas fa-times d-none" 
                    title="Cancelar" 
                    onclick="cancelEdit()">
            </button>
            <form id="delete-form" method="POST" action="{% url 'actividad_pagare_eliminar' %}" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="items_to_delete" id="items_to_delete_eliminar">
                <button id="delete-button" type="submit" class="btn btn-outline-danger fas fa-trash-alt" title="Eliminar"></button>
            </form>
            <form id="download-form" method="POST" action="{% url 'actividad_pagare_descargar_excel' %}" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="items_to_delete" id="items_to_delete_descargar">
                <button type="submit" 
                        class="btn btn-outline-info fas fa-download" 
                        title="Descargar Excel">
                </button>
            </form>
        </div>
    </div>
    <div class="card-footer text-muted">
        <div class="table-responsive">
            <table class="table table-primary">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="select-all"></th>
                        <th>ID</th>
                        <th>Descripción</th>
                    </tr>
                </thead>
                <tbody>
                    {% for actividad in actividades %}
                    <tr data-id="{{ actividad.Act_PagareId }}">
                        <td><input type="checkbox" class="row-select" value="{{ actividad.Act_PagareId }}"></td>
                        <td>{{ actividad.Act_PagareId }}</td>
                        <td class="text-start">
                            <span class="descripcion-text">{{ actividad.Descripcion_Act }}</span>
                            <input type="text" 
                                   name="Descripcion_Act" 
                                   class="descripcion-input form-control d-none" 
                                   value="{{ actividad.Descripcion_Act }}" 
                                   readonly>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3">No hay actividades registradas</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div id="message-box" class="alert alert-dismissible fade" style="display: none;">
        <span id="alert-message"></span>
    </div>
    <!-- Modal Confirmación -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Eliminación</h5>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de eliminar las actividades seleccionadas?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn">Eliminar</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src=\"{% static 'JS/ActMaestro.js' %}\"></script>
{% endblock %}