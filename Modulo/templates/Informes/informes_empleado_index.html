{% extends 'base.html' %}
{% load static %}

{% block titulo %}
  Informe de Empleados
{% endblock %}

{% block contenido %}
  <div class="card">
    <div class="card-header">
      <h4 class="card-title">Informe de Empleados</h4>
    </div>
    <div class="card-body informes-table">
      <div class="container-fluid mb-3">
        <!-- Formulario principal -->
        <form method="GET">
          <!-- Filtros en la parte superior -->
          <div class="row mb-3">
            <div class="col-md-3">
              <label for="Documento">{{ form.Nombre.label }}</label>
              {{ form.Nombre }}
            </div>
            <div class="col-md-3">
              <label for="Linea">{{ form.LineaId.label }}</label>
              {{ form.LineaId }}
            </div>
            <div class="col-md-3">
              <label for="Cargo">{{ form.Cargo.label }}</label>
              {{ form.Cargo }}
            </div>
            <div class="col-md-3">
              <label for="Certificaciones">{{ form.CertificadoSAP.label }}</label>
              {{ form.CertificadoSAP }}
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-3">
              <label for="PerfilId">{{ form.PerfilId.label }}</label>
              {{ form.PerfilId }}
            </div>
            <div class="col-md-3">
              <label for="Activo">{{ form.Activo.label }}</label>
              {{ form.Activo }}
            </div>
          </div>
          <!-- Botones en la parte inferior -->
          <div class="row">
            <div class="col-md-6 text-start">
              <button type="submit" name="buscar" class="btn btn-primary"><i class="fas fa-search"></i> Buscar</button>
            </div>
          </div>
        </form>
        <!-- Botón de Descargar Excel -->
        <div class="row">
          <div class="col-md-6 text-end offset-md-6">
            <form id="download-form" method="GET" action="{% url 'exportar_empleados_excel' %}">
              {% csrf_token %}
              <input type="hidden" name="Nombre" value="{{ form.Nombre.value }}" />
              <input type="hidden" name="LineaId" value="{{ form.LineaId.value }}" />
              <input type="hidden" name="Cargo" value="{{ form.Cargo.value }}" />
              <input type="hidden" name="CertificadoSAP" value="{{ form.CertificadoSAP.value }}" />
              <input type="hidden" name="PerfilId" value="{{ form.PerfilId.value }}" />
              <input type="hidden" name="Activo" value="{{ form.Activo.value }}" />
              <button type="submit" class="btn btn-success">
                  <i class="fas fa-file-excel"></i> Descargar Excel
              </button>
            </form>
          </div>
        </div>
      </div>

      {% if show_data %}
        <!-- Mostrar tabla de empleados -->
        <div class="table-responsive" style="max-height: 80vh; overflow: auto;">
          <table class="table table-bordered table-hover table-primary w-100"  id="nominaTable">
            <thead>
              <tr>
                <th data-sort="TipoDocumento" class="sortable" data-direction="default">
                  Tipo Documento
                  <span class="sort-icon">
                      <i class="fas fa-sort sort-icon-default"></i>
                      <i class="fas fa-sort-up sort-icon-asc"></i>
                      <i class="fas fa-sort-down sort-icon-desc"></i>
                  </span>
                </th>
                <th data-sort="Documento" class="sortable" data-direction="default">
                  Documento
                  <span class="sort-icon">
                      <i class="fas fa-sort sort-icon-default"></i>
                      <i class="fas fa-sort-up sort-icon-asc"></i>
                      <i class="fas fa-sort-down sort-icon-desc"></i>
                  </span>
                </th>
                <th data-sort="Nombre" class="sortable" data-direction="default">
                  Nombre
                  <span class="sort-icon">
                      <i class="fas fa-sort sort-icon-default"></i>
                      <i class="fas fa-sort-up sort-icon-asc"></i>
                      <i class="fas fa-sort-down sort-icon-desc"></i>
                  </span>
                </th>
                <th>Fecha Nacimiento</th>
                <th>Fecha Ingreso</th>
                <th>Fecha Operación</th>
                <th data-sort="Modulo" class="sortable" data-direction="default">
                  Módulo
                  <span class="sort-icon">
                      <i class="fas fa-sort sort-icon-default"></i>
                      <i class="fas fa-sort-up sort-icon-asc"></i>
                      <i class="fas fa-sort-down sort-icon-desc"></i>
                  </span>
                </th>
                <th data-sort="Perfil" class="sortable" data-direction="default">
                  Perfil
                  <span class="sort-icon">
                      <i class="fas fa-sort sort-icon-default"></i>
                      <i class="fas fa-sort-up sort-icon-asc"></i>
                      <i class="fas fa-sort-down sort-icon-desc"></i>
                  </span>
                </th>
                <th data-sort="Linea" class="sortable" data-direction="default">
                  Línea
                  <span class="sort-icon">
                      <i class="fas fa-sort sort-icon-default"></i>
                      <i class="fas fa-sort-up sort-icon-asc"></i>
                      <i class="fas fa-sort-down sort-icon-desc"></i>
                  </span>
                </th>
                <th data-sort="Cargo" class="sortable" data-direction="default">
                  Cargo
                  <span class="sort-icon">
                      <i class="fas fa-sort sort-icon-default"></i>
                      <i class="fas fa-sort-up sort-icon-asc"></i>
                      <i class="fas fa-sort-down sort-icon-desc"></i>
                  </span>
                </th>
                <th>Título Profesional</th>
                <th>Fecha Grado</th>
                <th>Universidad</th>
                <th>Profesión Realizada</th>
                <th>Academia SAP</th>
                <th>Certificado SAP</th>
                <th>Otras Certificaciones</th>
                <th>Postgrados</th>
                <th>Activo</th>
                <th>Fecha Retiro</th>
                <th>Dirección</th>
                <th>Ciudad</th>
                <th>Departamento</th>
                <th>Dirección Alterna</th>
                <th>Teléfono 1</th>
                <th>Teléfono 2</th>
              </tr>
            </thead>
            <tbody>
              {% for empleado in empleados_info %}
                <tr>
                  <td class="text-start">{{ empleado.TipoDocumento }}</td>
                  <td class="text-end">{{ empleado.Documento }}</td>
                  <td class="text-start">{{ empleado.Nombre }}</td>
                  <td>{{ empleado.FechaNacimiento|date:'d/m/Y' }}</td>
                  <td>{{ empleado.FechaIngreso|date:'d/m/Y' }}</td>
                  <td>{{ empleado.FechaOperacion|date:'d/m/Y' }}</td>
                  <td class="text-start">{{ empleado.Modulo }}</td>
                  <td class="text-start">{{ empleado.Perfil }}</td>
                  <td class="text-start">{{ empleado.Linea }}</td>
                  <td class="text-start">{{ empleado.CargoId }}</td>
                  <td class="text-start">{{ empleado.TituloProfesional }}</td>
                  <td>{{ empleado.FechaGrado|date:'d/m/Y' }}</td>
                  <td class="text-start">{{ empleado.Universidad }}</td>
                  <td class="text-start">{{ empleado.ProfesionRealizada }}</td>
                  <td>{{ empleado.AcademiaSAP }}</td>
                  <td>{{ empleado.CertificadoSAP }}</td>
                  <td>{{ empleado.OtrasCertificaciones }}</td>
                  <td>{{ empleado.Postgrados }}</td>                  
                  <td>{{ empleado.Activo }}</td>
                  <td>{{ empleado.FechaRetiro|date:'d/m/Y' }}</td>
                  <td class="text-start">{{ empleado.Direccion|default_if_none:"" }}</td>
                  <td class="text-start">{{ empleado.Ciudad|default_if_none:"" }}</td>
                  <td class="text-start">{{ empleado.Departamento|default_if_none:"" }}</td>
                  <td class="text-start">{{ empleado.DireccionAlterna|default_if_none:"" }}</td>
                  <td class="text-end">{{ empleado.Telefono1|default_if_none:"" }}</td>
                  <td class="text-end">{{ empleado.Telefono2|default_if_none:"" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-warning" role="alert">
              {% if not busqueda_realizada %}
                  No se ha realizado ninguna búsqueda aún.
              {% else %}
                  No se encontraron resultados para los filtros aplicados.
              {% endif %}
        </div>
      {% endif %}
        
                
    </div>
  </div>
{% endblock %}
