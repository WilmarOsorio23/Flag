{% extends 'base.html' %}
{% load static %}

{% block titulo %}
  Informe de Clientes
{% endblock %}

{% block contenido %}
  <div class="card">
    <div class="card-header">
      <h4 class="card-title">Informe de Clientes</h4>
    </div>
    <div class="card-body informes-table">
      <div class="container-fluid mb-3">
        <!-- Formulario de filtros -->
        <form method="GET">
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="Cliente">{{ form.Nombre_Cliente.label }}</label>
              {{ form.Nombre_Cliente }}
            </div>
            <div class="col-md-4">
              <label for="Activo">{{ form.Activo.label }}</label>
              {{ form.Activo }}
            </div>
            <div class="col-md-4">
              <label for="Pais">{{ form.Pais.label }}</label>
              {{ form.Pais }}
            </div>
          </div>
          <div class="row mb-3">            
            <div class="col-md-4">
              <label for="Ciudad">{{ form.Ciudad.label }}</label>
              {{ form.Ciudad }}
            </div>
            <div class="col-md-4">
              <label for="TipoCliente">{{ form.TipoCliente.label }}</label>
              {{ form.TipoCliente }}
            </div>
            <div class="col-md-4">
              <label for="Nacional">{{ form.Nacional.label }}</label>
              {{ form.Nacional }}
            </div>
          </div>
          <!-- Botón de búsqueda -->
          <div class="row">
            <div class="col-md-6 text-start">
              <button type="submit" name="buscar" class="btn btn-primary"><i class="fas fa-search"></i> Buscar</button>
            </div>
          </div>
        </form>
        
        <!-- Botón para descargar Excel -->
        <div class="row">
          <div class="col-md-6 text-end offset-md-6">
            <form method="GET" action="{% url 'exportar_clientes_excel' %}">
              <!-- Pasar todos los filtros actuales -->
              <input type="hidden" name="Nombre_Cliente" value="{{ form.Nombre_Cliente.value|default:'' }}" />
              <input type="hidden" name="Activo" value="{{ form.Activo.value|default:'' }}" />
              <input type="hidden" name="Pais" value="{{ form.Pais.value|default:'' }}" />
              <input type="hidden" name="Ciudad" value="{{ form.Ciudad.value|default:'' }}" />
              <input type="hidden" name="TipoCliente" value="{{ form.TipoCliente.value|default:'' }}" />
              <input type="hidden" name="Nacional" value="{{ form.Nacional.value|default:'' }}" />
              <button type="submit" class="btn btn-success">
                <i class="fas fa-file-excel"></i> Descargar Excel
              </button>
            </form>
          </div>
        </div>
      </div>
      
      {% if show_data %}
        <!-- Tabla de clientes -->
        <div class="table-responsive" style="max-height: 80vh; overflow: auto;">
          <table class="table table-bordered table-hover table-primary w-100">
            <thead>
              <tr>
                <th data-sort="DocumentoId" class="sortable" data-direction="default">
                    Documento
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th data-sort="TipoDocumentoID" class="sortable" data-direction="default">
                    Tipo Documento
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th data-sort="Nombre_Cliente" class="sortable" data-direction="default">
                    Nombre Cliente
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th>Activo</th>
                <th>Fecha Inicio</th>
                <th>Fecha Retiro</th>
                <th data-sort="Direccion" class="sortable" data-direction="default">
                    Dirección
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th data-sort="Telefono" class="sortable" data-direction="default">
                    Teléfono
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th>Correo Electrónico</th>
                <th>Contacto</th>
                <th>Buzón Facturación</th>
                <th data-sort="TipoCliente" class="sortable" data-direction="default">
                    Tipo Cliente
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th data-sort="Ciudad" class="sortable" data-direction="default">
                    Ciudad
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th data-sort="Departamento" class="sortable" data-direction="default">
                    Departamento
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th data-sort="Pais" class="sortable" data-direction="default">
                    País
                    <span class="sort-icon">
                        <i class="fas fa-sort sort-icon-default"></i>
                        <i class="fas fa-sort-up sort-icon-asc"></i>
                        <i class="fas fa-sort-down sort-icon-desc"></i>
                    </span>
                </th>
                <th>Nacional</th>
              </tr>
            </thead>
            <tbody>
              {% for cliente in clientes_info %}
                <tr>
                    <td class="text-end">{{ cliente.DocumentoId }}</td>
                    <td class="text-start">{{ cliente.TipoDocumentoID }}</td>
                    <td class="text-start">{{ cliente.Nombre_Cliente }}</td>
                    <td>{{ cliente.Activo }}</td>
                    <td>{{ cliente.Fecha_Inicio|date:'d/m/Y' }}</td>
                    <td>{{ cliente.Fecha_Retiro|date:'d/m/Y'|default_if_none:'' }}</td>
                    <td class="text-start">{{ cliente.Direccion|default_if_none:'' }}</td>
                    <td class="text-end">{{ cliente.Telefono|default_if_none:'' }}</td>
                    <td class="text-start">{{ cliente.CorreoElectronico|default_if_none:'' }}</td>
                    <td class="text-start">{{ cliente.ContactoID|default_if_none:'' }}</td>
                    <td class="text-start">{{ cliente.BuzonFacturacion|default_if_none:'' }}</td>
                    <td class="text-start">{{ cliente.TipoCliente|default_if_none:'' }}</td>
                    <td class="text-start">{{ cliente.Ciudad|default_if_none:'' }}</td>
                    <td class="text-start">{{ cliente.Departamento|default_if_none:'' }}</td>
                    <td class="text-start">{{ cliente.Pais|default_if_none:'' }}</td>
                    <td>{{ cliente.Nacional|default_if_none:'' }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-warning" role="alert">
            {% if not busqueda_realizada %}
                No se ha realizado ninguna búsqueda aún.
            {% else %}
                No se encontraron resultados para los filtros aplicados.
      {% endif %}
        </div>
    {% endif %}
    </div>
  </div>
{% endblock %}