{% extends "base.html" %}

{% block titulo %} Crear Tarifa de Consultor {% endblock %}

{% block contenido %}
<h2>Crear Nueva Tarifa de Consultor</h2>
<form method="POST">
    {% csrf_token %}
    <div id="form-fields">
        {{ form.as_p }}
    </div>
    <div id="empresa-consultor" class="mb-3" style="display:none;">
        <label class="form-label"><strong>Empresa:</strong></label>
        <span id="empresa-consultor-value"></span>
    </div>
    <button type="submit" class="btn btn-primary">Guardar</button>
    <a href="{% url 'tarifa_consultores_index' %}" class="btn btn-danger">Cancelar</a>
</form>
<script>
// Este script obtiene la empresa del consultor seleccionado
const consultoresEmpresas = {};
{% for consultor in form.fields.documentoId.queryset %}
    consultoresEmpresas['{{ consultor.Documento }}'] = '{{ consultor.Empresa|escapejs }}';
{% endfor %}

const selectConsultor = document.querySelector('select[name="documentoId"]');
const empresaDiv = document.getElementById('empresa-consultor');
const empresaValue = document.getElementById('empresa-consultor-value');
if (selectConsultor) {
    selectConsultor.addEventListener('change', function() {
        const doc = this.value;
        if (consultoresEmpresas[doc]) {
            empresaValue.textContent = consultoresEmpresas[doc];
            empresaDiv.style.display = 'block';
        } else {
            empresaDiv.style.display = 'none';
        }
    });
    // Mostrar empresa si ya hay un valor seleccionado
    if (selectConsultor.value && consultoresEmpresas[selectConsultor.value]) {
        empresaValue.textContent = consultoresEmpresas[selectConsultor.value];
        empresaDiv.style.display = 'block';
    }
}
</script>
{% endblock %}
